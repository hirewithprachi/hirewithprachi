import{aV as t}from"./index-CYK67J1M.js";const e=t("https://ktqrzokrqizfjqdgwmqs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0cXJ6b2tycWl6ZmpxZGd3bXFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyMzIzOTIsImV4cCI6MjA2OTgwODM5Mn0.2g3y9b7bsX444RlJ5_syCtHb-WEhHmZf2WxucPrRiPQ");class r{static async getCurrentUser(){try{const{data:{user:t},error:r}=await e.auth.getUser();if(r)throw r;if(!t)return{success:!1,error:"No authenticated user"};const{data:s,error:o}=await e.from("hr_user_profiles").select("*").eq("user_id",t.id).single();if(o)throw o;return{success:!0,user:{...t,profile:s}}}catch(t){return console.error("Error getting current user:",t),{success:!1,error:t.message}}}static async updateUserProfile(t){try{const{data:{user:r},error:s}=await e.auth.getUser();if(s)throw s;const{data:o,error:a}=await e.from("hr_user_profiles").update(t).eq("user_id",r.id).select().single();if(a)throw a;return{success:!0,profile:o}}catch(r){return console.error("Error updating user profile:",r),{success:!1,error:r.message}}}static async getUserUsage(){try{const{data:{user:t},error:r}=await e.auth.getUser();if(r)throw r;const{data:s,error:o}=await e.from("hr_user_profiles").select("subscription_plan, monthly_document_limit, documents_used_this_month, total_documents_created").eq("user_id",t.id).single();if(o)throw o;return{success:!0,usage:{plan:s.subscription_plan,limit:s.monthly_document_limit,used:s.documents_used_this_month,total:s.total_documents_created,remaining:-1===s.monthly_document_limit?-1:s.monthly_document_limit-s.documents_used_this_month}}}catch(t){return console.error("Error getting user usage:",t),{success:!1,error:t.message}}}static async getToolCategories(){try{const{data:t,error:r}=await e.from("hr_tool_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(r)throw r;return{success:!0,categories:t}}catch(t){return console.error("Error getting tool categories:",t),{success:!1,error:t.message}}}static async getTools(t=null,r=20){try{let s=e.from("hr_tools").select("\n          *,\n          hr_tool_categories(name, slug, icon, color)\n        ").eq("status","published").order("usage_count",{ascending:!1}).limit(r);t&&(s=s.eq("hr_tool_categories.slug",t));const{data:o,error:a}=await s;if(a)throw a;return{success:!0,tools:o}}catch(s){return console.error("Error getting tools:",s),{success:!1,error:s.message}}}static async getToolBySlug(t){try{const{data:r,error:s}=await e.from("hr_tools").select("\n          *,\n          hr_tool_categories(name, slug, icon, color),\n          document_templates(id, name, description, template_type, is_premium, price_inr)\n        ").eq("slug",t).eq("status","published").single();if(s)throw s;return{success:!0,tool:r}}catch(r){return console.error("Error getting tool:",r),{success:!1,error:r.message}}}static async getPopularTools(t=6){try{const{data:r,error:s}=await e.from("hr_tools").select("\n          *,\n          hr_tool_categories(name, slug, icon, color)\n        ").eq("status","published").eq("is_popular",!0).order("usage_count",{ascending:!1}).limit(t);if(s)throw s;return{success:!0,tools:r}}catch(r){return console.error("Error getting popular tools:",r),{success:!1,error:r.message}}}static async createDocument(t,r,s){try{const{data:{user:o},error:a}=await e.auth.getUser();if(a)throw a;const n=await this.getUserUsage();if(!n.success)throw new Error(n.error);if(0===n.usage.remaining)return{success:!1,error:"Document limit reached. Please upgrade your plan.",requiresUpgrade:!0};const{data:i,error:c}=await e.from("user_documents").insert({user_id:o.id,tool_id:t,title:s,document_type:"generated",input_data:r,status:"processing",expires_at:new Date(Date.now()+2592e6).toISOString()}).select().single();if(c)throw c;return await this.trackToolUsage(t,i.id,"start"),{success:!0,document:i}}catch(o){return console.error("Error creating document:",o),{success:!1,error:o.message}}}static async updateDocumentStatus(t,r,s=null){try{const o={status:r,processing_time_seconds:"completed"===r?Math.floor(30*Math.random())+5:null};s&&(o.output_file_url=s,o.file_size_bytes=Math.floor(1e6*Math.random())+5e4);const{data:a,error:n}=await e.from("user_documents").update(o).eq("id",t).select().single();if(n)throw n;return"completed"===r&&await this.trackToolUsage(a.tool_id,t,"complete"),{success:!0,document:a}}catch(o){return console.error("Error updating document status:",o),{success:!1,error:o.message}}}static async getUserDocuments(t=20){try{const{data:{user:r},error:s}=await e.auth.getUser();if(s)throw s;const{data:o,error:a}=await e.from("user_documents").select("\n          *,\n          hr_tools(name, slug, hr_tool_categories(name, icon))\n        ").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(t);if(a)throw a;return{success:!0,documents:o}}catch(r){return console.error("Error getting user documents:",r),{success:!1,error:r.message}}}static async downloadDocument(t){try{const{data:{user:r},error:s}=await e.auth.getUser();if(s)throw s;const{data:o,error:a}=await e.from("user_documents").select("*").eq("id",t).eq("user_id",r.id).single();if(a)throw a;return"completed"!==o.status?{success:!1,error:"Document not ready for download"}:(await e.from("user_documents").update({download_count:o.download_count+1,last_downloaded_at:(new Date).toISOString()}).eq("id",t),await this.trackToolUsage(o.tool_id,t,"download"),{success:!0,document:o})}catch(r){return console.error("Error downloading document:",r),{success:!1,error:r.message}}}static async getSubscriptionPlans(){try{const{data:t,error:r}=await e.from("subscription_plans").select("*").eq("is_active",!0).order("price_inr",{ascending:!0});if(r)throw r;return{success:!0,plans:t}}catch(t){return console.error("Error getting subscription plans:",t),{success:!1,error:t.message}}}static async getUserSubscription(){try{const{data:{user:t},error:r}=await e.auth.getUser();if(r)throw r;const{data:s,error:o}=await e.from("user_subscriptions").select("\n          *,\n          subscription_plans(name, slug, price_inr, features)\n        ").eq("user_id",t.id).eq("status","active").single();if(o&&"PGRST116"!==o.code)throw o;return{success:!0,subscription:s}}catch(t){return console.error("Error getting user subscription:",t),{success:!1,error:t.message}}}static async createPaymentOrder(t,r,s={}){try{const{data:{user:o},error:a}=await e.auth.getUser();if(a)throw a;const{data:n,error:i}=await e.from("payment_transactions").insert({user_id:o.id,transaction_type:"one_time",amount_inr:t,description:r,status:"pending",metadata:s}).select().single();if(i)throw i;return{success:!0,transaction:n}}catch(o){return console.error("Error creating payment order:",o),{success:!1,error:o.message}}}static async trackToolUsage(t,r,s){try{const{data:{user:o},error:a}=await e.auth.getUser();if(a)return;await e.from("tool_usage_analytics").insert({user_id:o?.id,tool_id:t,document_id:r,action_type:s,session_id:this.getSessionId(),user_agent:navigator.userAgent,metadata:{timestamp:(new Date).toISOString()}})}catch(o){console.error("Error tracking tool usage:",o)}}static async trackUserBehavior(t,r){try{const{data:{user:s},error:o}=await e.auth.getUser();if(o)return;await e.from("user_behavior_analytics").insert({user_id:s?.id,event_type:t,event_data:r,session_id:this.getSessionId(),page_url:window.location.href,user_agent:navigator.userAgent})}catch(s){console.error("Error tracking user behavior:",s)}}static getSessionId(){let t=sessionStorage.getItem("hr_saas_session_id");return t||(t="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("hr_saas_session_id",t)),t}static async generateContent(t,r,s=null){try{const{data:{user:o},error:a}=await e.auth.getUser();if(a)throw a;const{data:n,error:i}=await e.from("ai_generation_requests").insert({user_id:o.id,tool_id:t,prompt:this.buildPrompt(r,s),input_data:r,status:"processing"}).select().single();if(i)throw i;const c=await this.processWithAI(r,s);return await e.from("ai_generation_requests").update({output_data:c,status:"completed",tokens_used:Math.floor(1e3*Math.random())+500,cost_usd:(.1*Math.random()+.01).toFixed(4),processing_time_seconds:Math.floor(30*Math.random())+5}).eq("id",n.id),{success:!0,result:c,aiRequestId:n.id}}catch(o){return console.error("Error generating content:",o),{success:!1,error:o.message}}}static buildPrompt(t,e){const r=`Generate professional HR content based on the following input: ${JSON.stringify(t)}`;return e?`${r}\n\nUse the ${e} template style and format.`:r}static async processWithAI(t,e){return new Promise(r=>{setTimeout(()=>{const s={content:`Generated content for ${e||"default"} template based on: ${JSON.stringify(t)}`,format:"pdf",metadata:{generated_at:(new Date).toISOString(),template_used:e||"default"}};r(s)},2e3+3e3*Math.random())})}static async getUserNotifications(t=10){try{const{data:{user:r},error:s}=await e.auth.getUser();if(s)throw s;const{data:o,error:a}=await e.from("user_notifications").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(t);if(a)throw a;return{success:!0,notifications:o}}catch(r){return console.error("Error getting notifications:",r),{success:!1,error:r.message}}}static async markNotificationAsRead(t){try{const{data:{user:r},error:s}=await e.auth.getUser();if(s)throw s;const{data:o,error:a}=await e.from("user_notifications").update({is_read:!0}).eq("id",t).eq("user_id",r.id).select().single();if(a)throw a;return{success:!0,notification:o}}catch(r){return console.error("Error marking notification as read:",r),{success:!1,error:r.message}}}static formatCurrency(t,e="INR"){return new Intl.NumberFormat("en-IN",{style:"currency",currency:e}).format(t)}static formatFileSize(t){if(0===t)return"0 Bytes";const e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]}static getTimeAgo(t){const e=Math.floor((new Date-new Date(t))/1e3);let r=e/31536e3;return r>1?Math.floor(r)+" years ago":(r=e/2592e3,r>1?Math.floor(r)+" months ago":(r=e/86400,r>1?Math.floor(r)+" days ago":(r=e/3600,r>1?Math.floor(r)+" hours ago":(r=e/60,r>1?Math.floor(r)+" minutes ago":Math.floor(e)+" seconds ago"))))}}export{r as H};
